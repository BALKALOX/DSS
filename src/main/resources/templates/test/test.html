<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Рішення по задачі</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
<div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-4">Рішення до задачі: <span id="task-title" class="text-blue-600"></span></h1>
    <p class="mb-2 text-gray-700"><strong>Опис:</strong> <span id="task-description"></span></p>
    <p class="mb-4 text-gray-700"><strong>Категорія:</strong> <span id="task-category"></span></p>

    <div id="decisions-container" class="space-y-6"></div>
</div>

<script>
    const taskId = 102;
    const token = "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJtaXNpdXJhLmFudG9uQGxsbC5rcGkudWEiLCJpYXQiOjE3NDU1NjkzMzEsImV4cCI6MTc0NTY1NTczMX0.4AyR8qGyRJPNewSOAUey40_JJDK6uGar0vKEe5PSA-I";

    fetch(`http://localhost:8080/api/v1/tasks/${taskId}`, {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        }
    })
        .then(res => res.json())
        .then(taskData => {
            document.getElementById('task-title').textContent = taskData.title;
            document.getElementById('task-description').textContent = taskData.description;
            document.getElementById('task-category').textContent = taskData.category;

            const container = document.getElementById('decisions-container');

            taskData.decisions.forEach(decision => {
                const decisionCard = document.createElement('div');
                decisionCard.className = 'bg-white rounded-lg shadow p-4';

                const userName = decision.user?.name || "Невідомий користувач";
                const userRole = decision.user?.roles?.length ? decision.user.roles[0].name : "Невідома роль";

                decisionCard.innerHTML = `
          <h2 class="text-xl font-semibold mb-1">${decision.description}</h2>
          <p class="text-sm text-gray-600 mb-2"><strong>Тип:</strong> ${decision.decisionCategory} | <strong>Статус:</strong> ${decision.decisionStatus}</p>
          <p class="text-sm text-gray-700 mb-4"><strong>Користувач:</strong> ${userName} (${userRole})</p>
          <div class="mb-4">
            <h3 class="font-semibold">Сценарії:</h3>
            ${decision.scenarios.map(s => `
              <div class="mt-1 ml-4">
                <p><strong>${s.title}</strong> – ${s.description} <em>(Ймовірність: ${s.possibility * 100}%)</em></p>
              </div>
            `).join('')}
          </div>
          <div>
            <h3 class="font-semibold">Параметри рішення:</h3>
            <table class="w-full border text-sm mt-2">
              <thead class="bg-gray-100">
                <tr>
                  <th class="p-2 border">Назва</th>
                  <th class="p-2 border">Значення</th>
                  <th class="p-2 border">Коментар</th>
                </tr>
              </thead>
              <tbody>
                ${decision.decisionParameters.map(p => `
                  <tr>
                    <td class="p-2 border">${p.taskParameter.name}</td>
                    <td class="p-2 border">${p.value} ${p.taskParameter.unit}</td>
                    <td class="p-2 border">${p.comment}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;

                container.appendChild(decisionCard);
            });
        })
        .catch(error => {
            console.error("Помилка при отриманні даних:", error);
        });
</script>
</body>
</html>
